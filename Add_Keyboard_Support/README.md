# Adding keyboard support

Writing an OS is great fun, but it would be better if it can interact with the user right, instead of only printing lot of stuff on the screen. 

In this section we will see how to interact with keyboard, and get the user input. 

The topic covered by this section will be: 

* [Handling the keyboard interrupt](InterruptHandling.md)
* [Keyboard Commands](Keyboard.md) 
* [Writing a driver](DriverImplementation.md)
* [Translating Scancodes](README.md)

## Keyboard Overview

Before proceeding further let's have a quick overview of the keyboard. 

The keyboard usually communicate with a PS/2 controller using serial communication, even if modern keyboard are USB they can still communicate using the old PS/2 protocol. 

Keyboards can accept several commands, and generate interrupts, usually an interrupt is generated whenever a byte is placed on the communication port. 

Whenever a key is pressed or released the keyboard place a code on a communication port, the code is called *scancode*, it can be composed by one or more bytes. 

Currently there are three different sets of scancodes that are available (1, 2 and 3) usually 1 and 2 are the most widely supported and usually the ps/2 controller starts with the translation mode enabled, that means that whatever scancode set is used it will be translated into set 1.

The scancode that is generated when a key is pressed is called the **make** code, while the scancode generated by a key release is calle the **break** code.

So in order to develop our keyboard driver we need to make a set of steps: 

* First identify the scancode set used by our keyboard, this is important because it is going to influence our mapping
* Enable the Keyboard IRQ, how to do this depends if we are using the PIC or the IOAPIC, but in both cases we need to set up a handler and unmask the relevan entry into a IRQ table
* Read the scancode byte 
* Store it in a buffer along with the current status (we will se later what the status is).

As you can see the scancode translation is not in the list above, in fact even if it is related to the keyboard is not really part of the device driver. 

### Useful Links

* https://wiki.osdev.org/PS/2_Keyboard 
* https://wiki.osdev.org/IRQ#From_the_keyboard.27s_perspective
* https://wiki.osdev.org/%228042%22_PS/2_Controller#Translation
* https://www.win.tue.nl/~aeb/linux/kbd/scancodes-10.html#scancodesets
* http://www.brokenthorn.com/Resources/OSDev19.html






